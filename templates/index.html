<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>eleyi</title>
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>

<body>
	<div class="header">
		<img src="{{ url_for('static', filename='logo.svg') }}" class="logo">
	</div>
<div class="input_container">
	<input type="text" placeholder="Choose starting point..." class="input" id="origin"/>
	<img src="{{ url_for('static', filename='geolocation_icon.png') }}" class="geolocation_icon" onclick="getLocation()">
</div>
<div class="input_container">
	<input type="text" placeholder="Choose destination..." class="input" id="destination"/>
</div>
<button onclick="searchItinaries()">Search</button>
<div id="error"></div>
<div id="itinaries"></div>
<div id="map"></div>
		  
	  
<script>
// This example requires the Places library. Include the libraries=places
// parameter when you first load the API. For example:
// <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
	var map;
	function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
		center: {lat: 6.12, lng: 1.21},
		zoom: 10
		});
		
		var input = document.getElementById('destination');

		var autocomplete = new google.maps.places.Autocomplete(input);

		// Bind the map's bounds (viewport) property to the autocomplete object,
		// so that the autocomplete requests use the current map bounds for the
		// bounds option in the request.
		autocomplete.bindTo('bounds', map);

		// Set the data fields to return when the user selects a place.
		autocomplete.setFields(
			['address_components', 'geometry', 'icon', 'name']);


		var marker = new google.maps.Marker({
		map: map,
		anchorPoint: new google.maps.Point(0, -29)
		});

		autocomplete.addListener('place_changed', function() {
		
		marker.setVisible(false);
		var place = autocomplete.getPlace();
		if (!place.geometry) {
			// User entered the name of a Place that was not suggested and
			// pressed the Enter key, or the Place Details request failed.
			window.alert("No details available for input: '" + place.name + "'");
			return;
		}

		// If the place has a geometry, then present it on a map.
		if (place.geometry.viewport) {
			map.fitBounds(place.geometry.viewport);
		} else {
			map.setCenter(place.geometry.location);
			map.setZoom(17);  // Why 17? Because it looks good.
		}
		marker.setPosition(place.geometry.location);
		marker.setVisible(true);
		});
	}

	var x = document.getElementById("error");
	var origin = { latitude: 0, longitude: 0 };
	var destination = { latitude: 0, longitude: 0 };
	function getLocation() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showPosition);
		} else { 
			x.innerHTML = "Geolocation is not supported by this browser.";
		}
	}

	function showPosition(position) {
		origin.latitude = position.coords.latitude;
		origin.longitude = position.coords.longitude;
		//x.innerHTML = "Latitude: " + position.coords.latitude + 
		//"<br>Longitude: " + position.coords.longitude;
		var here = {lat: position.coords.latitude, lng: position.coords.longitude};
		var marker = new google.maps.Marker({
			map: map,
			position: here
		});
		map.setCenter(here);
		map.setZoom(17);
		document.getElementById("origin").value = "My location";
	}

	function searchItinaries(){
		// DO THE THING

		//Display
		var itinaries = [
			{
				timeToDeparture : 5,
				timeToArrival : 10,
				chauffeur : {
					name : 'Honoré',
					rating : 4.6
				}
			}
		];
		var itinariesDiv = document.getElementById('itinaries');
		itinaries.forEach(itinary => {

			var chauffeurDiv = document.createElement("div");
			chauffeurDiv.innerHTML = itinary.chauffeur.name + " (" + itinary.chauffeur.rating + "/5)";

			var timeToDepartureDiv = document.createElement("div");
			timeToDepartureDiv.innerHTML = "Votre bus viendra vous chercher dans " + itinary.timeToDeparture + " minutes.";
			
			var timeToArrivalDiv = document.createElement("div");
			timeToArrivalDiv.innerHTML = "Arrivée à destination prévue dans " + itinary.timeToArrival + " minutes.";

			var itinaryDiv = document.createElement("div");
			itinaryDiv.appendChild(chauffeurDiv);
			itinaryDiv.appendChild(timeToDepartureDiv);
			itinaryDiv.appendChild(timeToArrivalDiv);
			itinaryDiv.className = "itinary";
			document.getElementById('itinaries').appendChild(itinaryDiv);
			
		});
	}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ mapsApiKey }}&libraries=places&callback=initMap" async defer></script>
</body>
</html>